# Plan: Debug Multi-Line Diff Duplication Issue

## Problem Summary
A 3-line modified block shows the same content repeated 5-6 times (15-18 rows for one change).
The algorithm correctly computes 5 modified blocks with proper lineDiffs, but each block is rendered 5-6 times.

## Verified (from user's description)
- Algorithm correctly computes modified blocks with proper lineDiffs
- Classified results have correct line counts (e.g., a 3-line block has 3 lineDiffs)
- The issue is in the rendering code in index.html

## Root Cause Analysis
The rendering code for multi-line modified entries is at index.html lines 3296-3358.

### Potential Issues to Investigate:

1. **Outer loop processing same entry multiple times** - The main loop at line 3059 iterates over results. If the results array contains duplicate entries, each would be rendered.

2. **Inner loop running more times than expected** - The loop at line 3319:
   ```javascript
   const lineCount = Math.max(validModLines.length, validAddedLines.length);
   for (let i = 0; i < lineCount; i++) {
   ```
   If `lineCount` is calculated incorrectly, this could cause extra iterations.

3. **lineDiffs mismatch** - The algorithm computes lineDiffs based on removedLine/addedLine, but if there's a mismatch between what's stored and what's rendered, it could cause issues.

## Implementation Plan

### Step 1: Add debug logging to identify where duplication occurs
Add console.log in index.html at:
- Line 3059: Log each result entry being processed
- Line 3319: Log lineCount and iteration number
- Line 3352/3356: Log when rows are appended

### Step 2: Run test and identify exact duplication point
Compare expected vs actual row counts to pinpoint where extra rows are created.

### Step 3: Fix the identified issue
Based on findings, fix the specific bug.

## Critical Files
- `/Users/jtally/diff/index.html` - Rendering code with the bug

## Verification
1. Run comparison with known multi-line diff
2. Check console logs to identify duplication point
3. Verify fix resolves issue
